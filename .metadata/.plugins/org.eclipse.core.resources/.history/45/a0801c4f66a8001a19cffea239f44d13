package dao.database;

import java.sql.DriverManager;
import java.sql.ResultSet;

import com.mysql.jdbc.Connection;
import com.mysql.jdbc.PreparedStatement;

public class AlterDataBase {

	/**
	 * Etant donné que j ai omis de spécifier la contrainte AutoIcrement pour les clés primaires des tables
	 * lors de la génération de la base de donnée,
	 * J ai donc crée cette classe pour Modifier toutes les clés primaires
	 *  en AutoIncrément Unique.
	 */
	public static void main(String[] args) {
		String url= "jdbc:mysql://localhost:3306/";
        String dbName = "pfe2019";
        String driver = "com.mysql.jdbc.Driver";
        String userName = "root";
        String password = "";
        try {
        	DriverManager.registerDriver( new com.mysql.jdbc.Driver());
            Connection con = (Connection)DriverManager.getConnection(url+dbName,userName,password);
            /*
             * Lire
             */
            String query="SELECT TABLE_NAME, COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE COLUMN_NAME='ID' AND TABLE_SCHEMA = 'pfe2019';";
            PreparedStatement statement = (PreparedStatement) con.prepareStatement(query);
    	
    		ResultSet rs=statement.executeQuery(query);
    		//int i=0;
    		while (rs.next()) {
    			/*
    			 * i++;
    			 * System.out.println("Table "+i+" : "+ rs.getString(1)+" Champs : "+rs.getString(2));
    			 * 
    			*/
    			String query2="ALTER TABLE "+ rs.getString(1)+" CHANGE `ID` `ID` INT( 11 ) NOT NULL AUTO_INCREMENT UNIQUE;";
    			 
    			PreparedStatement statement2 = (PreparedStatement) con.prepareStatement(query);
    	    	statement2.executeUpdate(query2);
        		statement2.close();
    		}
    		rs.close();
    		statement.close();
    		
    		// Changer le moteur de la base de Données de MyIsam vers InnoDB
    		query = "SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'pfe2019' AND ENGINE = 'MyISAM'";
    		statement = (PreparedStatement) con.prepareStatement(query);
        	
    		rs=statement.executeQuery(query);
    		//int i=0;
    		while (rs.next()) {
    			String query2="ALTER TABLE "+ rs.getString(1)+" ENGINE=INNODB;";
    			PreparedStatement statement2 = (PreparedStatement) con.prepareStatement(query);
    	    	statement2.executeUpdate(query2);
        		statement2.close();
    		}
    		rs.close();
    		statement.close();
        }
        catch (Exception e) {
            e.printStackTrace();
        }

	}

}
